---
import BaseLayout from "../layouts/BaseLayout.astro";
import terms from "../data/workshop-terms.json";

const openTerms = (terms || []).filter(t => (t.status || "").toLowerCase() === "open");
const formatTerm = (t) => `${t.date} – ${t.title} (${t.city}) – ${t.price} €`;
---
<BaseLayout title="Workshopy | FerkoMedia" description="Rezervácia termínu workshopu.">
  <section class="hero">
    <div class="eyebrow">Workshopy</div>
    <h1>Praktické workshopy s výsledkom</h1>
    <p class="lead">
      Na workshopoch pracujete na vlastnom projekte. Odídete s konkrétnym výsledkom a jasným ďalším postupom.
    </p>
    <div class="actions">
      <a class="btn btn--primary" href="#terminy">Pozrieť termíny</a>
      <a class="btn btn--ghost" href="#rezervacia">Rezervovať miesto</a>
    </div>
  </section>

  <section class="section" id="o">
    <div class="grid3">
      <div class="card"><h3>Pre koho</h3><p>Živnostníci, malé firmy, lokálne služby, freelanceri.</p></div>
      <div class="card"><h3>Čo získate</h3><p>Hotový výsledok / nastavenie + kontrolný checklist + odporúčania na ďalšie kroky.</p></div>
      <div class="card"><h3>Forma</h3><p>Prakticky, krok za krokom. Minimum teórie, maximum reálneho posunu.</p></div>
    </div>
  </section>

  <section class="section" id="terminy">
    <h2>Aktuálne termíny</h2>
    {openTerms.length === 0 ? (
      <div class="card"><p>Termíny doplníme čoskoro. Ak chcete, napíšte a dáme vám vedieť prvý voľný termín.</p></div>
    ) : (
      <div class="grid2">
        {openTerms.map(t => (
          <div class="card">
            <h3>{t.title}</h3>
            <p><strong>{t.date}</strong> • {t.city} • {t.price} € • kapacita {t.capacity}</p>
            <div class="actions">
              <a class="btn btn--primary" href="#rezervacia">Rezervovať</a>
            </div>
          </div>
        ))}
      </div>
    )}
  </section>

  <section class="section" id="rezervacia">
    <h2>Rezervačný formulár</h2>

    <div class="formCard">
      <form
        name="workshopy"
        method="POST"
        data-netlify="true"
        action="/dakujem-workshopy/"
        data-domain-form
      >
        <input type="hidden" name="form-name" value="workshopy" />

        <div class="formGrid">
          <div class="field">
            <label for="wsName">Meno a priezvisko</label>
            <input id="wsName" name="Meno a priezvisko" placeholder="Vaše meno" required />
          </div>

          <div class="field">
            <label for="wsEmail">E-mail</label>
            <input id="wsEmail" type="email" name="E-mail" placeholder="napr. meno@firma.sk" required />
          </div>

          <div class="field">
            <label for="wsPhone">Telefón</label>
            <input id="wsPhone" name="Telefón" placeholder="+421…" />
          </div>

          <div class="field">
            <label for="wsTerm">Termín workshopu</label>
            <select id="wsTerm" name="Termín workshopu" required>
              <option value="" selected disabled>Vyberte termín</option>
              {openTerms.map(t => <option value={formatTerm(t)}>{formatTerm(t)}</option>)}
            </select>
          </div>

          <div class="field">
            <label for="wsDomain">Doména (.sk) (voliteľné)</label>
            <input id="wsDomain" name="Doména (.sk)" placeholder="napr. mojadomena.sk" />
            <div class="statusLine" data-domain-status></div>
          </div>

          <div class="field" style="grid-column: 1 / -1;">
            <label for="wsNote">Poznámka (voliteľné)</label>
            <textarea id="wsNote" name="Poznámka" placeholder="Ak máte otázku alebo špeciálnu požiadavku, napíšte sem."></textarea>
          </div>
        </div>

        <div class="formActions">
          <label class="checkRow">
            <input type="checkbox" name="GDPR súhlas" required />
            Súhlasím so spracovaním osobných údajov za účelom vybavenia rezervácie.
          </label>

          <button class="btn btn--primary" type="submit">Rezervovať miesto</button>
        </div>
      </form>
    </div>
  </section>

  <script type="module" src="/src/scripts/enrich-forms.js"></script>
</BaseLayout>
