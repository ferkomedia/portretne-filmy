---
import BaseLayout from "../layouts/BaseLayout.astro";
import terms from "../data/workshop-terms.json";

const openTerms = (terms || []).filter(t => t.status === "open");
---

<BaseLayout title="Workshopy | FerkoMedia" description="Rezervuj si miesto na workshop.">
  <section class="hero">
    <p class="kicker">Workshopy</p>
    <h1>Rezervovať miesto na workshop</h1>
    <p class="lead">
      Vyber si termín a pošli rezerváciu. Ozvem sa s potvrdením a detailmi.
    </p>
  </section>

  <section class="panel">
    <h2>Aktuálne termíny</h2>

    {openTerms.length === 0 ? (
      <p class="muted">Momentálne nemáme vypísané termíny. Napíš mi a dám ti vedieť najbližší dostupný dátum.</p>
    ) : (
      <div class="cards">
        {openTerms.map(t => (
          <div class="card">
            <div class="cardTitle">{t.title}</div>
            <div class="cardMeta">
              <span>{t.date} • {t.time}</span>
              <span>{t.city}</span>
              <span>{t.price}</span>
            </div>
          </div>
        ))}
      </div>
    )}
  </section>

  <section class="panel">
    <h2>Rezervačný formulár</h2>

    <form
      class="fmForm"
      name="workshopy"
      method="POST"
      data-netlify="true"
      netlify-honeypot="bot-field"
      action="/dakujem-workshopy"
    >
      <input type="hidden" name="form-name" value="workshopy" />
      <p class="srOnly">
        <label>Nechaj prázdne: <input name="bot-field" /></label>
      </p>

      <div class="grid2">
        <div class="field">
          <label for="wsName">Meno a priezvisko</label>
          <input id="wsName" name="Meno a priezvisko" type="text" required placeholder="Napíš svoje meno" />
        </div>

        <div class="field">
          <label for="wsEmail">E-mail</label>
          <input id="wsEmail" name="E-mail" type="email" required placeholder="napr. meno@firma.sk" />
        </div>

        <div class="field">
          <label for="wsPhone">Telefón</label>
          <input id="wsPhone" name="Telefón" type="tel" required placeholder="+421..." />
        </div>

        <div class="field">
          <label for="wsTerm">Termín workshopu</label>
          <select id="wsTerm" name="Termín workshopu" required>
            <option value="" selected disabled hidden>–</option>
            {openTerms.map(t => (
              <option value={`${t.date} ${t.time} — ${t.title} (${t.city})`}>
                {t.date} {t.time} — {t.title} ({t.city})
              </option>
            ))}
          </select>
        </div>

        <div class="field full">
          <label for="wsNote">Poznámka (voliteľné)</label>
          <textarea id="wsNote" name="Poznámka" rows="4" placeholder="Ak máš otázku alebo špeciálnu požiadavku, napíš sem."></textarea>
        </div>
      </div>

      <div class="actions">
        <button class="btn btnPrimary" type="submit">Rezervovať miesto</button>
      </div>
    </form>

    <div class="dash">
      <h3>Správa termínov (malý dashboard)</h3>
      <p class="muted">
        Termíny sa upravujú v súbore <code>src/data/workshop-terms.json</code>. Po push do GitHubu sa Netlify samo deployne.
      </p>
      <pre class="code">{JSON.stringify(openTerms, null, 2)}</pre>
    </div>
  </section>
</BaseLayout>
