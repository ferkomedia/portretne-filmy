---
import BaseLayout from "../layouts/BaseLayout.astro";
---
<BaseLayout
  title="Cenn√≠k | Portr√©tne filmy a Workshopy"
  description="Portr√©tne filmy od 1290‚Ç¨, praktick√© workshopy od 129‚Ç¨. Objednajte online a pla≈•te bezpeƒçne kartou."
>

  <section class="hero">
    <div class="eyebrow">Cenn√≠k</div>
    <h1>Invest√≠cia, ktor√° m√° zmysel</h1>
    <p class="lead">Vyberte si, ƒço potrebujete. Pla≈•te bezpeƒçne online.</p>
  </section>

  <!-- PORTR√âTNE FILMY -->
  <section class="section" id="filmy">
    <h2>Portr√©tne filmy</h2>

    <div class="grid2">
      <div class="card cardPricing">
        <div class="cardBadge">Najpopul√°rnej≈°√≠</div>
        <h3>Osobnos≈•</h3>
        <div class="price">1 290 ‚Ç¨</div>

        <p class="cardLead">V√°≈° pr√≠beh. Va≈°a energia. Zachyten√© nav≈ædy.</p>

        <ul class="checkList">
          <li>Osobn√° konzult√°cia a pr√≠prava</li>
          <li>Celodenn√© nat√°ƒçanie</li>
          <li>Film 3-5 min√∫t v 4K</li>
          <li>Profesion√°lny strih a color grading</li>
          <li>Licencovan√° hudba</li>
        </ul>

        <div class="cardActions">
          <button class="btn btn--primary" data-pay="Portr√©tny film Osobnos≈•" data-amount="129000">Objedna≈• za 1 290 ‚Ç¨</button>
        </div>
      </div>

      <div class="card cardPricing">
        <h3>≈Ωivotn√Ω pr√≠beh</h3>
        <div class="price">2 290 ‚Ç¨</div>

        <p class="cardLead">Pr√≠behy, ktor√© by sa nemali zabudn√∫≈•.</p>

        <ul class="checkList">
          <li>Hƒ∫bkov√° pr√≠prava a rozhovory</li>
          <li>2 nat√°ƒçacie dni</li>
          <li>Film 8-15 min√∫t v 4K</li>
          <li>Arch√≠vne fotografie a spomienky</li>
          <li>Profesion√°lny strih a hudba</li>
        </ul>

        <div class="cardActions">
          <button class="btn btn--primary" data-pay="Portr√©tny film ≈Ωivotn√Ω pr√≠beh" data-amount="229000">Objedna≈• za 2 290 ‚Ç¨</button>
        </div>
      </div>
    </div>
  </section>

  <!-- WORKSHOPY -->
  <section class="section" id="workshopy">
    <h2>Workshopy za 1 de≈à</h2>
    <p class="sectionLead">Pr√≠de≈° r√°no, od√≠de≈° veƒçer s hotov√Ωm v√Ωsledkom.</p>

    <div class="grid3">
      <div class="card cardPricing cardCompact">
        <h3>Web za 1 de≈à</h3>
        <div class="price">149 ‚Ç¨</div>
        <p>Postav si vlastn√Ω web od nuly. WordPress, dizajn, texty, SEO z√°klady.</p>
        <button class="btn btn--primary btn--full" data-pay="Workshop: Web za 1 de≈à" data-amount="14900">Rezervova≈•</button>
      </div>

      <div class="card cardPricing cardCompact">
        <h3>E-shop za 1 de≈à</h3>
        <div class="price">179 ‚Ç¨</div>
        <p>Funkƒçn√Ω e-shop s produktmi, platbami a dopravou.</p>
        <button class="btn btn--primary btn--full" data-pay="Workshop: E-shop za 1 de≈à" data-amount="17900">Rezervova≈•</button>
      </div>

      <div class="card cardPricing cardCompact">
        <h3>Google reklama za 1 de≈à</h3>
        <div class="price">149 ‚Ç¨</div>
        <p>Nastav si kampane, kƒæ√∫ƒçov√© slov√° a rozpoƒçet.</p>
        <button class="btn btn--primary btn--full" data-pay="Workshop: Google reklama za 1 de≈à" data-amount="14900">Rezervova≈•</button>
      </div>

      <div class="card cardPricing cardCompact">
        <h3>Soci√°lne siete za 1 de≈à</h3>
        <div class="price">129 ‚Ç¨</div>
        <p>Obsahov√Ω pl√°n, ≈°abl√≥ny, nat√°ƒçanie. Buƒè konzistentn√Ω.</p>
        <button class="btn btn--primary btn--full" data-pay="Workshop: Soci√°lne siete za 1 de≈à" data-amount="12900">Rezervova≈•</button>
      </div>

      <div class="card cardPricing cardCompact">
        <h3>AI n√°stroje za 1 de≈à</h3>
        <div class="price">129 ‚Ç¨</div>
        <p>ChatGPT, automatiz√°cie, AI pre texty a procesy.</p>
        <button class="btn btn--primary btn--full" data-pay="Workshop: AI n√°stroje za 1 de≈à" data-amount="12900">Rezervova≈•</button>
      </div>

      <div class="card cardPricing cardCompact">
        <h3>Na mieru</h3>
        <div class="price">Dohodou</div>
        <p>Potrebuje≈° kombin√°ciu? Nap√≠≈° a vysklad√°me de≈à.</p>
        <a class="btn btn--ghost btn--full" href="/kontakt#objednat">Nap√≠sa≈• dopyt</a>
      </div>
    </div>
  </section>

  <!-- BAL√çKY -->
  <section class="section" id="baliky">
    <h2>V√Ωhodn√© bal√≠ky</h2>
    <p class="sectionLead">Kombinuj a u≈°etri.</p>

    <div class="grid3">
      <div class="card cardPricing">
        <h3>Starter</h3>
        <div class="price">249 ‚Ç¨</div>
        <div class="priceNote">U≈°etr√≠≈° ~50 ‚Ç¨</div>
        <p>2 ƒæubovoƒæn√© workshopy podƒæa vlastn√©ho v√Ωberu.</p>
        <button class="btn btn--primary btn--full" data-pay="Bal√≠k Starter (2 workshopy)" data-amount="24900">Vybra≈• bal√≠k</button>
      </div>

      <div class="card cardPricing cardHighlight">
        <div class="cardBadge">Najlep≈°ia hodnota</div>
        <h3>Business</h3>
        <div class="price">399 ‚Ç¨</div>
        <div class="priceNote">U≈°etr√≠≈° ~100 ‚Ç¨</div>
        <p>3 workshopy + 1 hodina konzult√°cie.</p>
        <button class="btn btn--primary btn--full" data-pay="Bal√≠k Business (3 workshopy + konzult√°cia)" data-amount="39900">Vybra≈• bal√≠k</button>
      </div>

      <div class="card cardPricing">
        <h3>Premium</h3>
        <div class="price">1 690 ‚Ç¨</div>
        <div class="priceNote">U≈°etr√≠≈° ~150 ‚Ç¨</div>
        <p>Portr√©tny film Osobnos≈• + 2 workshopy.</p>
        <button class="btn btn--primary btn--full" data-pay="Bal√≠k Premium (film + 2 workshopy)" data-amount="169000">Vybra≈• bal√≠k</button>
      </div>
    </div>
  </section>

  <!-- FAQ -->
  <section class="section" id="faq">
    <h2>ƒåast√© ot√°zky</h2>
    <div class="grid2">
      <div class="card">
        <h3>Ako prebieha platba?</h3>
        <p>Plat√≠te bezpeƒçne kartou cez Stripe. Podporujeme Visa, Mastercard, Apple Pay, Google Pay.</p>
      </div>
      <div class="card">
        <h3>M√¥≈æem stornova≈•?</h3>
        <p>Workshopy: do 7 dn√≠ pred term√≠nom vr√°t√≠me 100%. Filmy: z√°loha je nevratn√°, ale term√≠n presunieme.</p>
      </div>
      <div class="card">
        <h3>Dostanem fakt√∫ru?</h3>
        <p>√Åno, fakt√∫ru posielame e-mailom automaticky po platbe.</p>
      </div>
      <div class="card">
        <h3>Kde prebiehaj√∫ workshopy?</h3>
        <p>V Martine a okol√≠. Presn√∫ adresu po≈°leme po rezerv√°cii.</p>
      </div>
    </div>
  </section>

  <!-- PAYMENT MODAL -->
  <div id="paymentModal" class="modal">
    <div class="modalContent">
      <button class="modalClose" id="closeModal">&times;</button>

      <div class="modalHeader">
        <h2 id="modalProduct">Produkt</h2>
        <div class="modalPrice" id="modalPrice">0 ‚Ç¨</div>
      </div>

      <!-- Payment method tabs -->
      <div class="paymentTabs">
        <button class="paymentTab active" data-tab="card">üí≥ Platba kartou</button>
        <button class="paymentTab" data-tab="qr">üì± QR platba</button>
      </div>

      <!-- Card payment -->
      <div id="cardPayment" class="paymentPanel active">
        <div id="payment-element"></div>
        <div id="payment-message"></div>
        <button id="submitPayment" class="btn btn--primary btn--full" disabled>
          <span id="btnText">Zaplati≈•</span>
          <span id="btnSpinner" class="spinner"></span>
        </button>
      </div>

      <!-- QR payment -->
      <div id="qrPayment" class="paymentPanel">
        <div class="qrInfo">
          <p>Naskenujte QR k√≥d v mobilnej aplik√°cii va≈°ej banky:</p>
          <div class="qrCode" id="qrCodeContainer"></div>
          <div class="bankDetails">
            <p><strong>IBAN:</strong> SK89 0900 0000 0051 8312 3456</p>
            <p><strong>Suma:</strong> <span id="qrAmount">0 ‚Ç¨</span></p>
            <p><strong>Variabiln√Ω symbol:</strong> <span id="qrVS">-</span></p>
            <p><strong>Pozn√°mka:</strong> <span id="qrNote">-</span></p>
          </div>
          <p class="qrNote">Po odoslan√≠ platby v√°s budeme kontaktova≈• do 24 hod√≠n.</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Stripe.js -->
  <script src="https://js.stripe.com/v3/"></script>
  <!-- QR Code library -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      var stripe = Stripe('pk_live_51SIajzK7AvTQZ0XNgrY5daEJeZX4ew0fxpRaVwgahpvPAamiISdRB0SpwlPYtbrvnsJritP542yNLaZximzBZwZo007qtYg79p');
      var elements = null;
      var paymentElement = null;
      var currentProduct = null;
      var currentAmount = 0;
      var qrCode = null;

      // Tab switching
      document.querySelectorAll('.paymentTab').forEach(function(tab) {
        tab.addEventListener('click', function() {
          var tabId = this.dataset.tab;

          document.querySelectorAll('.paymentTab').forEach(function(t) { t.classList.remove('active'); });
          document.querySelectorAll('.paymentPanel').forEach(function(p) { p.classList.remove('active'); });

          this.classList.add('active');
          document.getElementById(tabId + 'Payment').classList.add('active');

          if (tabId === 'card' && !paymentElement) {
            initPayment();
          }
        });
      });

      // Open modal on button click
      document.querySelectorAll('[data-pay]').forEach(function(btn) {
        btn.addEventListener('click', function() {
          currentProduct = this.dataset.pay;
          currentAmount = parseInt(this.dataset.amount);

          document.getElementById('modalProduct').textContent = currentProduct;
          var priceFormatted = (currentAmount / 100).toLocaleString('sk-SK') + ' ‚Ç¨';
          document.getElementById('modalPrice').textContent = priceFormatted;
          document.getElementById('paymentModal').classList.add('open');
          document.body.style.overflow = 'hidden';

          // Reset to card tab
          document.querySelectorAll('.paymentTab').forEach(function(t) { t.classList.remove('active'); });
          document.querySelectorAll('.paymentPanel').forEach(function(p) { p.classList.remove('active'); });
          document.querySelector('[data-tab="card"]').classList.add('active');
          document.getElementById('cardPayment').classList.add('active');

          // Reset payment element
          if (paymentElement) {
            paymentElement.unmount();
            paymentElement = null;
          }
          elements = null;

          // Generate QR
          generateQR();

          // Init card payment
          initPayment();
        });
      });

      function generateQR() {
        var vs = Date.now().toString().slice(-10);
        var amount = (currentAmount / 100).toFixed(2);

        document.getElementById('qrAmount').textContent = amount + ' ‚Ç¨';
        document.getElementById('qrVS').textContent = vs;
        document.getElementById('qrNote').textContent = currentProduct;

        // Clear previous QR
        var container = document.getElementById('qrCodeContainer');
        container.innerHTML = '';

        // PAY by square format for Slovak banks
        var qrData = 'SPD*1.0*ACC:SK8909000000005183123456*AM:' + amount + '*CC:EUR*X-VS:' + vs + '*MSG:' + encodeURIComponent(currentProduct);

        if (typeof QRCode !== 'undefined') {
          qrCode = new QRCode(container, {
            text: qrData,
            width: 200,
            height: 200,
            colorDark: '#000000',
            colorLight: '#ffffff'
          });
        }
      }

      // Close modal
      document.getElementById('closeModal').addEventListener('click', closeModal);
      document.getElementById('paymentModal').addEventListener('click', function(e) {
        if (e.target === this) closeModal();
      });

      function closeModal() {
        document.getElementById('paymentModal').classList.remove('open');
        document.body.style.overflow = '';
        if (paymentElement) {
          paymentElement.unmount();
          paymentElement = null;
        }
        elements = null;
      }

      async function initPayment() {
        if (paymentElement) return;

        document.getElementById('submitPayment').disabled = true;
        document.getElementById('payment-message').textContent = 'Naƒç√≠tavam...';

        try {
          var response = await fetch('/api/create-payment-intent', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              amount: currentAmount,
              productName: currentProduct
            })
          });

          var data = await response.json();

          if (data.error) {
            document.getElementById('payment-message').textContent = data.error;
            return;
          }

          var appearance = {
            theme: 'night',
            variables: {
              colorPrimary: '#f97316',
              colorBackground: '#1a1a1a',
              colorText: '#ffffff',
              colorDanger: '#ef4444',
              fontFamily: 'system-ui, sans-serif',
              borderRadius: '8px'
            },
            rules: {
              '.Input': {
                backgroundColor: '#0a0a0a',
                border: '1px solid #333'
              },
              '.Input:focus': {
                border: '1px solid #f97316',
                boxShadow: '0 0 0 1px #f97316'
              }
            }
          };

          elements = stripe.elements({ clientSecret: data.clientSecret, appearance: appearance, locale: 'sk' });
          paymentElement = elements.create('payment');
          paymentElement.mount('#payment-element');

          document.getElementById('payment-message').textContent = '';

          paymentElement.on('ready', function() {
            document.getElementById('submitPayment').disabled = false;
          });

        } catch (err) {
          document.getElementById('payment-message').textContent = 'Chyba: ' + err.message;
        }
      }

      // Submit payment
      document.getElementById('submitPayment').addEventListener('click', async function() {
        var btn = this;
        var btnText = document.getElementById('btnText');
        var spinner = document.getElementById('btnSpinner');
        var msg = document.getElementById('payment-message');

        btn.disabled = true;
        btnText.style.display = 'none';
        spinner.style.display = 'inline-block';
        msg.textContent = '';

        var result = await stripe.confirmPayment({
          elements: elements,
          confirmParams: {
            return_url: window.location.origin + '/dakujem-platba'
          },
          redirect: 'if_required'
        });

        if (result.error) {
          msg.textContent = result.error.message;
          btn.disabled = false;
          btnText.style.display = 'inline';
          spinner.style.display = 'none';
        } else {
          closeModal();
          window.location.href = '/dakujem-platba';
        }
      });
    });
  </script>

</BaseLayout>

<style>
  .cardPricing {
    display: flex;
    flex-direction: column;
    text-align: center;
  }
  .price {
    font-size: 2.5rem;
    font-weight: 700;
    color: #f97316;
    margin-bottom: 1rem;
  }
  .priceNote {
    font-size: 0.875rem;
    color: #22c55e;
    margin-top: -0.75rem;
    margin-bottom: 1rem;
  }
  .cardLead {
    font-weight: 500;
    margin-bottom: 0.75rem;
  }
  .checkList {
    list-style: none;
    padding: 0;
    margin: 1rem 0;
    text-align: left;
  }
  .checkList li {
    padding: 0.5rem 0 0.5rem 1.75rem;
    position: relative;
    border-bottom: 1px solid rgba(255,255,255,0.1);
  }
  .checkList li::before {
    content: "‚úì";
    position: absolute;
    left: 0;
    color: #22c55e;
    font-weight: bold;
  }
  .cardActions {
    margin-top: auto;
    padding-top: 1.5rem;
  }
  .cardCompact {
    padding: 1.5rem;
  }
  .cardCompact .price {
    font-size: 2rem;
    margin-bottom: 0.75rem;
  }
  .cardHighlight {
    border: 2px solid #f97316;
  }
  .cardBadge {
    position: absolute;
    top: -12px;
    left: 50%;
    transform: translateX(-50%);
    background: #f97316;
    color: #fff;
    padding: 0.25rem 1rem;
    border-radius: 20px;
    font-size: 0.75rem;
    font-weight: 600;
  }
  .btn--full {
    width: 100%;
  }
  .sectionLead {
    text-align: center;
    color: rgba(255,255,255,0.7);
    margin-bottom: 2rem;
  }

  /* Modal */
  .modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.8);
    z-index: 1000;
    align-items: center;
    justify-content: center;
    padding: 1rem;
  }
  .modal.open {
    display: flex;
  }
  .modalContent {
    background: #111;
    border: 1px solid #333;
    border-radius: 12px;
    padding: 2rem;
    max-width: 450px;
    width: 100%;
    position: relative;
  }
  .modalClose {
    position: absolute;
    top: 1rem;
    right: 1rem;
    background: none;
    border: none;
    color: #999;
    font-size: 1.5rem;
    cursor: pointer;
    line-height: 1;
  }
  .modalClose:hover {
    color: #fff;
  }
  .modalHeader {
    text-align: center;
    margin-bottom: 1.5rem;
  }
  .modalHeader h2 {
    font-size: 1.125rem;
    margin-bottom: 0.5rem;
  }
  .modalPrice {
    font-size: 2rem;
    font-weight: 700;
    color: #f97316;
  }
  #payment-element {
    margin-bottom: 1rem;
  }
  #payment-message {
    color: #ef4444;
    text-align: center;
    margin-bottom: 1rem;
    min-height: 1.25rem;
  }
  .spinner {
    display: none;
    width: 20px;
    height: 20px;
    border: 2px solid transparent;
    border-top-color: white;
    border-radius: 50%;
    animation: spin 0.8s linear infinite;
  }
  @keyframes spin {
    to { transform: rotate(360deg); }
  }

  /* Payment tabs */
  .paymentTabs {
    display: flex;
    gap: 0.5rem;
    margin-bottom: 1.5rem;
  }
  .paymentTab {
    flex: 1;
    padding: 0.75rem;
    background: rgba(255,255,255,0.05);
    border: 1px solid #333;
    border-radius: 8px;
    color: #999;
    font-size: 0.875rem;
    cursor: pointer;
    transition: all 0.2s;
  }
  .paymentTab:hover {
    background: rgba(255,255,255,0.1);
    color: #fff;
  }
  .paymentTab.active {
    background: rgba(249, 115, 22, 0.1);
    border-color: #f97316;
    color: #f97316;
  }
  .paymentPanel {
    display: none;
  }
  .paymentPanel.active {
    display: block;
  }

  /* QR payment */
  .qrInfo {
    text-align: center;
  }
  .qrInfo > p {
    color: #999;
    margin-bottom: 1rem;
  }
  .qrCode {
    display: inline-block;
    padding: 1rem;
    background: #fff;
    border-radius: 8px;
    margin-bottom: 1.5rem;
  }
  .bankDetails {
    background: rgba(255,255,255,0.05);
    border-radius: 8px;
    padding: 1rem;
    text-align: left;
    margin-bottom: 1rem;
  }
  .bankDetails p {
    margin: 0.5rem 0;
    font-size: 0.875rem;
  }
  .bankDetails strong {
    color: #999;
    display: inline-block;
    width: 140px;
  }
  .qrNote {
    font-size: 0.8rem;
    color: #666;
  }
</style>
