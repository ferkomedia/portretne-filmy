---
import BaseLayout from "../layouts/BaseLayout.astro";
import terms from "../data/workshop-terms.json";

const openTerms = terms.filter(t => t.status === "open");
const closedTerms = terms.filter(t => t.status !== "open");
---

<BaseLayout title="Admin | Správa workshopov" noindex={true}>
  <section class="hero">
    <div class="eyebrow">Admin</div>
    <h1>Správa termínov workshopov</h1>
    <p class="lead">Pridávaj, upravuj a spravuj termíny workshopov.</p>
  </section>

  <section class="section">
    <h2>Otvorené termíny ({openTerms.length})</h2>

    {openTerms.length === 0 && (
      <div class="card">
        <p>Žiadne otvorené termíny.</p>
      </div>
    )}

    {openTerms.length > 0 && (
      <div class="grid2">
        {openTerms.map((t) => (
          <div class="card cardOpen">
            <h3>{t.title}</h3>
            <p><strong>{t.date}</strong> • {t.city} • {t.price} € • kapacita {t.capacity}</p>
            <span class="badge badgeSuccess">Otvorený</span>
          </div>
        ))}
      </div>
    )}
  </section>

  {closedTerms.length > 0 && (
    <section class="section">
      <h2>Zatvorené termíny ({closedTerms.length})</h2>
      <div class="grid2">
        {closedTerms.map((t) => (
          <div class="card cardClosed">
            <h3>{t.title}</h3>
            <p><strong>{t.date}</strong> • {t.city} • {t.price} €</p>
            <span class="badge badgeMuted">Zatvorený</span>
          </div>
        ))}
      </div>
    </section>
  )}

  <section class="section">
    <h2>Pridať nový termín</h2>
    <div class="card">
      <form id="addTermForm">
        <div class="formGrid">
          <div class="field">
            <label for="title">Typ workshopu</label>
            <select id="title" required>
              <option value="">Vyber typ</option>
              <option value="Web za 1 deň">Web za 1 deň</option>
              <option value="E-shop za 1 deň">E-shop za 1 deň</option>
              <option value="Google reklama za 1 deň">Google reklama za 1 deň</option>
              <option value="Sociálne siete za 1 deň">Sociálne siete za 1 deň</option>
              <option value="AI nástroje za 1 deň">AI nástroje za 1 deň</option>
            </select>
          </div>

          <div class="field">
            <label for="date">Dátum</label>
            <input id="date" type="text" placeholder="DD.MM.RRRR" required />
          </div>

          <div class="field">
            <label for="city">Mesto</label>
            <input id="city" type="text" value="Martin" required />
          </div>

          <div class="field">
            <label for="price">Cena (€)</label>
            <input id="price" type="number" value="149" required />
          </div>

          <div class="field">
            <label for="capacity">Kapacita</label>
            <input id="capacity" type="number" value="12" required />
          </div>

          <div class="field">
            <label for="status">Status</label>
            <select id="status">
              <option value="open">Otvorený</option>
              <option value="closed">Zatvorený</option>
            </select>
          </div>
        </div>

        <div class="formActions">
          <button type="submit" class="btn btn--primary">Generovať JSON</button>
        </div>
      </form>

      <div id="jsonOutput" class="jsonOutput">
        <h3>Nový JSON záznam:</h3>
        <pre id="jsonCode"></pre>
        <p class="help">Skopíruj tento záznam a pridaj ho do súboru src/data/workshop-terms.json</p>
      </div>
    </div>
  </section>

  <section class="section">
    <h2>Ako upraviť termíny</h2>
    <div class="grid2">
      <div class="card">
        <h3>1. Otvor súbor</h3>
        <p>src/data/workshop-terms.json</p>
      </div>
      <div class="card">
        <h3>2. Uprav JSON</h3>
        <p>Pridaj, zmeň alebo odstráň termíny.</p>
      </div>
      <div class="card">
        <h3>3. Commit a Push</h3>
        <p>git add . && git commit -m "Update terms" && git push</p>
      </div>
      <div class="card">
        <h3>4. Hotovo</h3>
        <p>Cloudflare automaticky deployuje zmeny.</p>
      </div>
    </div>
  </section>

  <section class="section">
    <h2>Príklad JSON štruktúry</h2>
    <div class="card">
      <pre class="codeBlock">[
  {
    "title": "Web za 1 deň",
    "date": "25.01.2026",
    "city": "Martin",
    "price": 149,
    "capacity": 12,
    "status": "open"
  }
]</pre>
    </div>
  </section>

  <script>
    const form = document.getElementById('addTermForm');
    const output = document.getElementById('jsonOutput');
    const code = document.getElementById('jsonCode');

    form.addEventListener('submit', function(e) {
      e.preventDefault();

      const term = {
        title: document.getElementById('title').value,
        date: document.getElementById('date').value,
        city: document.getElementById('city').value,
        price: parseInt(document.getElementById('price').value),
        capacity: parseInt(document.getElementById('capacity').value),
        status: document.getElementById('status').value
      };

      code.textContent = JSON.stringify(term, null, 2);
      output.style.display = 'block';
    });
  </script>
</BaseLayout>

<style>
  .cardOpen {
    border-left: 4px solid #22c55e;
  }
  .cardClosed {
    opacity: 0.6;
    border-left: 4px solid #666;
  }
  .badge {
    display: inline-block;
    padding: 0.25rem 0.75rem;
    border-radius: 20px;
    font-size: 0.75rem;
    font-weight: 600;
    margin-top: 0.5rem;
  }
  .badgeSuccess {
    background: #22c55e;
    color: white;
  }
  .badgeMuted {
    background: rgba(255,255,255,0.2);
    color: rgba(255,255,255,0.7);
  }
  .jsonOutput {
    display: none;
    margin-top: 1.5rem;
  }
  .codeBlock, #jsonCode {
    background: rgba(0,0,0,0.3);
    padding: 1rem;
    border-radius: 8px;
    overflow-x: auto;
    font-family: monospace;
    font-size: 0.875rem;
    line-height: 1.5;
  }
</style>
